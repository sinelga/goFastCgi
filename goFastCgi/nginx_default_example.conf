
#user  nobody;
worker_processes  4;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    	worker_connections  1024;
	multi_accept on;
}


http {
    include       mime.types;
    default_type  application/octet-stream;


	log_format main '$remote_addr - $remote_user [$time_local] ' '$host "$request" $status $body_bytes_sent "$http_referer" ' '"$http_user_agent" "$http_x_forwarded_for"';
   	access_log /opt/nginx/logs/access.log main;

    	sendfile        on;
    	keepalive_timeout  65;
	tcp_nopush on;
	tcp_nodelay on;
	types_hash_max_size 2048;
	server_tokens off;


        fastcgi_cache_path /opt/nginx/cache levels=1:2 keys_zone=GOFAST:200m inactive=10m;
        fastcgi_cache_key "$bot$mobile$scheme$request_method$host$request_uri";

        add_header X-Cache $upstream_cache_status;

	gzip_static  on;	
	gzip on;
        gzip_buffers 16 8k;
        gzip_comp_level 6;
        gzip_http_version 1.1;
        gzip_min_length 10;
        gzip_types text/plain text/css image/png image/gif image/jpeg application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript im$
        gzip_vary on;
        gzip_proxied any;
        gzip_disable "MSIE [1-6]\.(?!.*SV1)";

	proxy_connect_timeout 90;
        proxy_send_timeout 90;
        proxy_read_timeout 90;
        proxy_buffer_size 4k;
        proxy_buffers 4 32k;
        proxy_busy_buffers_size 64k;
        proxy_temp_file_write_size 64k;
    	
      map $host $weblocale {
                hostnames;
                default fi_FI;
                include /opt/nginx/conf/weblocale.txt;
        }

       map $host $webthemes {
                hostnames;
                default finance;
                include /opt/nginx/conf/webthemes.txt;
        }


    server {
        listen       80;
        server_name  localhost;
	include fastcgi_params;


        location / {

                resolver 8.8.8.8;

                location /robots.txt { alias /home/juno/git/goFastCgi/goFastCgi/robots.txt; }
                location /favicon.ico { alias  /home/juno/git/goFastCgi/goFastCgi/finance_favicon.ico; }
                location /crossdomain.xml { return 404; }
                location /sitemap.xml { return 404;}

                if ($http_user_agent ~* (linkdex|mail.ru|sistrix|exabot|360spider|ncbot|facebookexternalhit|siteexplorer|linguee|spyder|garlikcrawler|pagesinventory|gimme60|zend_http_client|xenu|pycrawler|spider|searchmetricsbot|solomonobot|seznambot|mnogosearch|yeti|ia_archiver|backlinkcrawler|wotbox|mail.ru_bot|turnitinbot|aesop_com_spiderman|ahrefsbot|alexibot|backweb|bandit|batchftp|baiduspider|bigfoot|black.?hole|blackwidow|blowfish|botalot|buddy|builtbottough|bullseye|cheesebot|cherrypicker|chinaclaw|collector|copier|copyrightcheck|cosmos|crescent|curl|custo|da|diibot|disco|dittospyder|dragonfly|drip|easydl|ebingbong|ecatch|eirgrabber|exabot|ezooms|influencebot|mj12bot|netcraftsurveyagent|openindex|seokicks-robot|sistrix|sogou|sosospider|yandexbot|yandeximages|yandexmetrika)) {

			return 410;

		}

                set $bot 0;
                set $mobile 0;
		set $rootdir  /home/juno/git/nginxvakutus_mobi/nginxvakutus_mobi/dartapp/build/;

               if ($http_user_agent ~* googlebot|adsbot-google-mobile|msn|bing|msnbot-media|slurp) {
                        set $bot 1;
			root /home/juno/git/goFastCgi/goFastCgi/www/fi_FI/finance/$http_host;
				
                }


               # if ($bot = 1) {
               # 	root /home/juno/git/goFastCgi/goFastCgi/www/fi_FI/finance/$http_host;

                #}


                if ($http_user_agent ~* (android|symbian|ipad|iphone|nokia|wpdesktop)) {
                        set $mobile 1;
			set $rootdir /home/juno/git/nginxvakutus_mobi/nginxvakutus_mobi/dartapp/build/;
                }


               # if ( $mobile = 0) {
		#	set $rootdir  /home/juno/git/nginxvakutus_mobi/nginxvakutus_mobi/dartapp/build/;
               # }

                error_page     404 = @proxytoapp;
                log_not_found  off;
                error_page     403 = @proxytoapp;



        }


 	location @proxytoapp {

                fastcgi_pass    127.0.0.1:8000;
                fastcgi_cache   GOFAST;
                fastcgi_cache_valid 200 10m;

        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        }

#	location /mysql {
#            set $my_sql 'select * from  opcodes';
#            drizzle_query $my_sql;
#            drizzle_pass backend;
#	    rds_json on;	
#            drizzle_connect_timeout    500ms; # default 60s
#            drizzle_send_query_timeout 2s;    # default 60s
#            drizzle_recv_cols_timeout  1s;    # default 60s
#            drizzle_recv_rows_timeout  1s;    # default 60s
#        }


        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443;
    #    server_name  localhost;

    #    ssl                  on;
    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_timeout  5m;

    #    ssl_protocols  SSLv2 SSLv3 TLSv1;
    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers   on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

